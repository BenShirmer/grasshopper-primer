require(["gitbook", "jQuery"], function(gitbook, $) {

  function expand(chapter) {
    chapter.show();
    if (chapter.parent().attr('class') != 'summary'
        && chapter.parent().attr('class') != 'book-summary'
      && chapter.length != 0
       ) {
         expand(chapter.parent());
       }
  }

  gitbook.events.bind("page.change", function() {
    $('li.chapter').children('ul.articles').hide();
    $chapter = $('li.chapter.active');
    $children = $chapter.children('ul.articles');
    $parent = $chapter.parent();
    $siblings = $chapter.siblings().children('ul.articles');

    expand($chapter);

    if ($children.length > 0) {
      $children.slideDown(400);
    }
      
    //get data level to determin how many folders to go back to get to root
    $depth = $chapter.data('level').toString();
    $depth = $depth.replace(/\./g,"");
    $depth_num = $depth.length;
    //create string for going back folders
    $folder_string = "../";
    for (i=1; i<$depth_num; i++){
        $folder_string = $folder_string + "../";
    }
    
    //Add mode lab logo to top of side bar, and copyright to bottom of side bar
    $t = $('ul.summary');
    $t.prepend("<a href=\"http://modelab.is\" target=\"_blank\"><img class=\"logo\" src=\"" + $folder_string + "modelab_logo.png\"></a>");
    $t.append("<div style=\"padding-left:15px\">Copyright &copy; Mode Lab 2015</div>")
  });

});
